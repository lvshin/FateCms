function countDown(){var $send=$("#sendCode");var i=120;$("#sendCode").addClass("gray").css({cursor:"default"}).attr("disabled","disabled");var interval=setInterval(function(){$send.html("剩余"+i+"秒");i--;if(i<0){$("#sendCode").removeClass("gray").css({cursor:"pointer"}).removeAttr("disabled");$send.html("重新获取");clearInterval(interval)}},1000)}$(function(){$("#sendCode").click(function(){countDown();if($("#mobile").parent().next().children(".Validform_wrong").length==0){$.ajax({url:"op/sendVerificationCode",type:"post",dataType:"json",data:{mobile:$("#mobile").val(),geetest_challenge:$(".geetest_challenge").val(),geetest_validate:$(".geetest_validate").val(),geetest_seccode:$(".geetest_seccode").val()},success:function(data){if(data.success){var d2=dialog({content:data.msg});d2.show();setTimeout(function(){d2.close().remove()},2000)}else{dialog.alert(data.msg)}},error:function(data){alert("请求发送失败，请稍后再试")}})}else{dialog.alert($("#mobile").parent().next().children(".Validform_wrong").html())}});var form=$("#mobileForm").Validform({btnReset:"",tiptype:function(msg,o,cssctl){switch(o.type){case 1:$(o.obj).parent().next().children(".Validform_checktip").removeClass("Validform_right").removeClass("Validform_wrong").html(msg);$(o.obj).parent().parent().removeClass("has-error").removeClass("has-success");break;case 2:$(o.obj).parent().next().children(".Validform_checktip").addClass("Validform_right").html(msg);$(o.obj).parent().parent().removeClass("has-error").addClass("has-success");break;case 3:$(o.obj).parent().next().children(".Validform_checktip").addClass("Validform_wrong").html(msg);$(o.obj).parent().parent().removeClass("has-success").addClass("has-error");break;default:break}},ignoreHidden:true,dragonfly:false,tipSweep:false,label:".label",showAllError:true,postonce:true,datatype:{"code":/^\d{6}$/},usePlugin:{},beforeCheck:function(curform){},beforeSubmit:function(curform){},callback:function(data){mobile();return false}})});function mobile(){var options={url:"profile/updateMobile",type:"post",dataType:"json",success:function(data){var d=dialog({content:data.message});d.showModal();if(data.success){setTimeout(function(){location.href="profile/security"},1500)}else{setTimeout(function(){d.close().remove()},1500)}},error:function(){dialog.alert("请求发送失败，请稍后再试")}};if($("#mobile").val()!=""&&$("#code").val()!=""){$("#mobileForm").ajaxSubmit(options)}else{return false}};